# ğŸ”Œ Adapter Pattern Study Guide (é€‚é…å™¨æ¨¡å¼å­¦ä¹ æŒ‡å—)

> **Status**: ğŸ“š Study Document  
> **Pattern Type**: Structural Design Pattern (ç»“æ„å‹è®¾è®¡æ¨¡å¼)  
> **Primary Application**: Multi-Carrier API Integration (å¤šæ‰¿è¿å•†APIé›†æˆ)  

---

## ğŸ“– Table of Contents

1. [Pattern Overview](#-pattern-overview)
2. [Problem It Solves](#-problem-it-solves)
3. [Pattern Structure](#-pattern-structure)
4. [Logistics Application](#-logistics-application)
5. [Adapter vs Facade vs Proxy](#-adapter-vs-facade-vs-proxy)
6. [SOLID Principles Alignment](#-solid-principles-alignment)
7. [Implementation Variations](#-implementation-variations)
8. [Anti-Patterns to Avoid](#-anti-patterns-to-avoid)
9. [Chinese Tech References](#-chinese-tech-references)
10. [Self-Assessment](#-self-assessment)

---

## ğŸ¯ Pattern Overview

### Definition (å®šä¹‰)

> **Adapter Pattern** converts the interface of a class into another interface that clients expect. Adapter lets classes work together that couldn't otherwise because of incompatible interfaces.
>
> **é€‚é…å™¨æ¨¡å¼**å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚é€‚é…å™¨æ¨¡å¼è®©åŸæœ¬æ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚

### Visual Metaphor (å½¢è±¡æ¯”å–»)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THE POWER ADAPTER ANALOGY                                 â”‚
â”‚                    ç”µæºé€‚é…å™¨çš„æ¯”å–»                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Think of traveling from China to USA with your laptop:                     â”‚
â”‚  æƒ³è±¡å¸¦ç€ä½ çš„ç¬”è®°æœ¬ä»ä¸­å›½å»ç¾å›½:                                               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Your Laptop   â”‚                              â”‚   US Power      â”‚       â”‚
â”‚  â”‚   ä½ çš„ç¬”è®°æœ¬     â”‚                              â”‚   Outlet        â”‚       â”‚
â”‚  â”‚                 â”‚                              â”‚   ç¾å›½ç”µæºæ’åº§   â”‚       â”‚
â”‚  â”‚   Expects:      â”‚                              â”‚   Provides:     â”‚       â”‚
â”‚  â”‚   220V / Type A â”‚                              â”‚   110V / Type B â”‚       â”‚
â”‚  â”‚   ä¸­å›½æ ‡å‡†      â”‚                              â”‚   ç¾å›½æ ‡å‡†      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚           â”‚                                                â”‚                â”‚
â”‚           â”‚  INCOMPATIBLE!                                 â”‚                â”‚
â”‚           â”‚  æ¥å£ä¸å…¼å®¹!                                    â”‚                â”‚
â”‚           â”‚                                                â”‚                â”‚
â”‚           â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚                â”‚
â”‚           â”‚         â”‚    POWER ADAPTER    â”‚                â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€>â”‚    ç”µæºé€‚é…å™¨        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                     â”‚                     â”‚                                 â”‚
â”‚                     â”‚  Converts:          â”‚                                 â”‚
â”‚                     â”‚  110V â†’ 220V        â”‚                                 â”‚
â”‚                     â”‚  Type B â†’ Type A    â”‚                                 â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                                              â”‚
â”‚  In Code (Logistics):                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Our System     â”‚     â”‚  SFExpress      â”‚     â”‚  SF Express     â”‚       â”‚
â”‚  â”‚  æˆ‘ä»¬çš„ç³»ç»Ÿ      â”‚â”€â”€â”€â”€â–¶â”‚  Adapter        â”‚â”€â”€â”€â”€â–¶â”‚  API            â”‚       â”‚
â”‚  â”‚                 â”‚     â”‚  é¡ºä¸°é€‚é…å™¨      â”‚     â”‚  é¡ºä¸°API        â”‚       â”‚
â”‚  â”‚  BookingRequest â”‚     â”‚  Translates     â”‚     â”‚  SFOrderRequest â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â”‚  SAME REQUEST FORMAT â†’ DIFFERENT API FORMATS                                â”‚
â”‚  åŒæ ·çš„è¯·æ±‚æ ¼å¼ â†’ ä¸åŒçš„APIæ ¼å¼                                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### GoF Classification

| Aspect | Classification |
|--------|----------------|
| **Type** | Structural Pattern (ç»“æ„å‹æ¨¡å¼) |
| **Scope** | Class or Object |
| **Intent** | Interface conversion (æ¥å£è½¬æ¢) |
| **Related Patterns** | Bridge, Decorator, Proxy, Facade |

---

## ğŸ”¥ Problem It Solves

### The Integration Nightmare (Without Adapter)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WITHOUT ADAPTER: THE CHAOS                                â”‚
â”‚                    æ²¡æœ‰é€‚é…å™¨: æ··ä¹±åœºæ™¯                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  SCENARIO: Integrate 8 Chinese carriers, each with DIFFERENT APIs           â”‚
â”‚  åœºæ™¯: é›†æˆ8å®¶ä¸­å›½æ‰¿è¿å•†ï¼Œæ¯å®¶APIéƒ½ä¸åŒ                                        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  // âŒ BAD: CarrierService becomes a MONSTER                       â”‚    â”‚
â”‚  â”‚  public class CarrierService                                       â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      public async Task<BookingResult> BookShipmentAsync(           â”‚    â”‚
â”‚  â”‚          BookingRequest request)                                   â”‚    â”‚
â”‚  â”‚      {                                                             â”‚    â”‚
â”‚  â”‚          if (request.CarrierCode == "SF")                          â”‚    â”‚
â”‚  â”‚          {                                                         â”‚    â”‚
â”‚  â”‚              // 50 lines: Build SF-specific request format         â”‚    â”‚
â”‚  â”‚              var sfRequest = new SFOrderRequest {                  â”‚    â”‚
â”‚  â”‚                  partnerID = _sfConfig.PartnerId,                  â”‚    â”‚
â”‚  â”‚                  requestID = Guid.NewGuid().ToString(),            â”‚    â”‚
â”‚  â”‚                  cargoDetails = new {                              â”‚    â”‚
â”‚  â”‚                      name = request.Packages[0].Description,       â”‚    â”‚
â”‚  â”‚                      count = request.Packages.Count                â”‚    â”‚
â”‚  â”‚                  },                                                â”‚    â”‚
â”‚  â”‚                  // ... 40 more lines of SF-specific mapping       â”‚    â”‚
â”‚  â”‚              };                                                    â”‚    â”‚
â”‚  â”‚              // Handle SF authentication (HMAC-MD5 signature)      â”‚    â”‚
â”‚  â”‚              // Handle SF response mapping                         â”‚    â”‚
â”‚  â”‚          }                                                         â”‚    â”‚
â”‚  â”‚          else if (request.CarrierCode == "JD")                     â”‚    â”‚
â”‚  â”‚          {                                                         â”‚    â”‚
â”‚  â”‚              // 60 lines: Build JD-specific request format         â”‚    â”‚
â”‚  â”‚              // Handle JD OAuth 2.0 token refresh                  â”‚    â”‚
â”‚  â”‚              // Handle JD response mapping                         â”‚    â”‚
â”‚  â”‚          }                                                         â”‚    â”‚
â”‚  â”‚          else if (request.CarrierCode == "ZTO")                    â”‚    â”‚
â”‚  â”‚          {                                                         â”‚    â”‚
â”‚  â”‚              // 45 lines: ZTO format (note: uses "tel" not "mobile") â”‚    â”‚
â”‚  â”‚          }                                                         â”‚    â”‚
â”‚  â”‚          else if (request.CarrierCode == "YTO")                    â”‚    â”‚
â”‚  â”‚          {                                                         â”‚    â”‚
â”‚  â”‚              // 40 lines: YTO specific format                       â”‚    â”‚
â”‚  â”‚          }                                                         â”‚    â”‚
â”‚  â”‚          // ... 4 MORE CARRIERS ...                                â”‚    â”‚
â”‚  â”‚          // File is now 800+ lines!                                â”‚    â”‚
â”‚  â”‚      }                                                             â”‚    â”‚
â”‚  â”‚  }                                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  PROBLEMS:                                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                  â”‚
â”‚  â€¢ Single file with 800+ lines (impossible to maintain)                    â”‚
â”‚  â€¢ Adding new carrier = modifying existing code                            â”‚
â”‚  â€¢ Testing requires mocking 8 different APIs                               â”‚
â”‚  â€¢ Authentication logic mixed with business logic                          â”‚
â”‚  â€¢ One carrier bug can break all carriers                                  â”‚
â”‚                                                                              â”‚
â”‚  ä¸­æ–‡é—®é¢˜:                                                                   â”‚
â”‚  â€¢ å•ä¸ªæ–‡ä»¶800å¤šè¡Œï¼ˆæ— æ³•ç»´æŠ¤ï¼‰                                                â”‚
â”‚  â€¢ æ–°å¢æ‰¿è¿å•†éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç                                                  â”‚
â”‚  â€¢ æµ‹è¯•éœ€è¦mock 8ä¸ªä¸åŒçš„API                                                 â”‚
â”‚  â€¢ è®¤è¯é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘æ··åœ¨ä¸€èµ·                                                 â”‚
â”‚  â€¢ ä¸€ä¸ªæ‰¿è¿å•†çš„bugå¯èƒ½å½±å“æ‰€æœ‰æ‰¿è¿å•†                                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Incompatibility Examples

| Our Model | SF Express | JD Logistics | ZTO Express |
|-----------|------------|--------------|-------------|
| `Sender.Phone` | `contact_tel` | `senderInfo.mobile` | `sender.tel` |
| `Recipient.Name` | `d_contact` | `receiverInfo.name` | `receiver.realName` |
| `Package.Weight` | `cargo_total_weight` | `packageInfo[].weight` | `weight` (in grams!) |
| `TrackingNumber` | `waybillNo` | `deliveryId` | `billCode` |
| `ServiceType.Express` | `"1"` | `"JD_EXPRESS"` | `1` (integer) |
| **Auth Method** | HMAC-MD5 Sign | OAuth 2.0 | API Key |

---

## ğŸ— Pattern Structure

### Classic UML Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ADAPTER PATTERN UML                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚     Client      â”‚              â”‚      <<interface>>      â”‚               â”‚
â”‚  â”‚  (Our System)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚      ICarrierAdapter    â”‚               â”‚
â”‚  â”‚                 â”‚   uses       â”‚        (Target)         â”‚               â”‚
â”‚  â”‚ CarrierService  â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ + GetRateAsync()        â”‚               â”‚
â”‚                                   â”‚ + BookShipmentAsync()   â”‚               â”‚
â”‚                                   â”‚ + CancelShipmentAsync() â”‚               â”‚
â”‚                                   â”‚ + GetTrackingAsync()    â”‚               â”‚
â”‚                                   â”‚ + GenerateLabelAsync()  â”‚               â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                               â”‚                              â”‚
â”‚                                               â”‚ implements                   â”‚
â”‚                                               â”‚                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚              â”‚                    â”‚           â”‚          â”‚           â”‚      â”‚
â”‚              â–¼                    â–¼           â–¼          â–¼           â–¼      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ SFExpressAdapterâ”‚  â”‚JDLogisticsAdapterâ”‚ â”‚ZTOAdapterâ”‚ â”‚YTOAdapterâ”‚        â”‚
â”‚  â”‚    (Adapter)    â”‚  â”‚    (Adapter)     â”‚ â”‚(Adapter) â”‚ â”‚(Adapter) â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚ Implements all  â”‚  â”‚ Implements all  â”‚ â”‚          â”‚ â”‚          â”‚        â”‚
â”‚  â”‚ interface       â”‚  â”‚ interface       â”‚ â”‚  ...     â”‚ â”‚  ...     â”‚        â”‚
â”‚  â”‚ methods         â”‚  â”‚ methods         â”‚ â”‚          â”‚ â”‚          â”‚        â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚ â”‚          â”‚ â”‚          â”‚        â”‚
â”‚  â”‚ INTERNALLY:     â”‚  â”‚ INTERNALLY:     â”‚ â”‚          â”‚ â”‚          â”‚        â”‚
â”‚  â”‚ Calls SF API    â”‚  â”‚ Calls JD API    â”‚ â”‚          â”‚ â”‚          â”‚        â”‚
â”‚  â”‚ with SF format  â”‚  â”‚ with JD format  â”‚ â”‚          â”‚ â”‚          â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜        â”‚
â”‚           â”‚                    â”‚               â”‚            â”‚               â”‚
â”‚           â”‚ HTTP               â”‚ HTTP          â”‚ HTTP       â”‚ HTTP          â”‚
â”‚           â–¼                    â–¼               â–¼            â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  SF Express API â”‚  â”‚  JD Logistics   â”‚ â”‚ ZTO API  â”‚ â”‚ YTO API  â”‚        â”‚
â”‚  â”‚    (Adaptee)    â”‚  â”‚  API (Adaptee)  â”‚ â”‚(Adaptee) â”‚ â”‚(Adaptee) â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Object Adapter vs Class Adapter

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADAPTER IMPLEMENTATION TYPES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  OBJECT ADAPTER (ç»„åˆ - RECOMMENDED for C#)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚  Uses composition: Adapter HOLDS reference to Adaptee                       â”‚
â”‚  ä½¿ç”¨ç»„åˆ: é€‚é…å™¨æŒæœ‰è¢«é€‚é…å¯¹è±¡çš„å¼•ç”¨                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  public class SFExpressAdapter : ICarrierAdapter                   â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      private readonly ISFExpressApiClient _sfClient;  // Composition â”‚    â”‚
â”‚  â”‚      private readonly ILogger<SFExpressAdapter> _logger;           â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚      public SFExpressAdapter(                                      â”‚    â”‚
â”‚  â”‚          ISFExpressApiClient sfClient,                            â”‚    â”‚
â”‚  â”‚          ILogger<SFExpressAdapter> logger)                        â”‚    â”‚
â”‚  â”‚      {                                                             â”‚    â”‚
â”‚  â”‚          _sfClient = sfClient;                                    â”‚    â”‚
â”‚  â”‚          _logger = logger;                                        â”‚    â”‚
â”‚  â”‚      }                                                             â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚      public async Task<BookingResult> BookShipmentAsync(           â”‚    â”‚
â”‚  â”‚          BookingRequest request)                                   â”‚    â”‚
â”‚  â”‚      {                                                             â”‚    â”‚
â”‚  â”‚          // 1. Translate to SF format                              â”‚    â”‚
â”‚  â”‚          var sfRequest = MapToSFFormat(request);                   â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚          // 2. Call SF API via injected client                     â”‚    â”‚
â”‚  â”‚          var sfResponse = await _sfClient.CreateOrderAsync(sfRequest); â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚          // 3. Translate back to our format                        â”‚    â”‚
â”‚  â”‚          return MapFromSFResponse(sfResponse);                     â”‚    â”‚
â”‚  â”‚      }                                                             â”‚    â”‚
â”‚  â”‚  }                                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  âœ… Benefits:                                                                â”‚
â”‚  â€¢ Can adapt multiple adaptees at runtime                                   â”‚
â”‚  â€¢ Adaptee can be injected (testable)                                       â”‚
â”‚  â€¢ Follows Dependency Inversion                                             â”‚
â”‚  â€¢ Works with interfaces (C# preferred)                                     â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                                              â”‚
â”‚  CLASS ADAPTER (ç»§æ‰¿ - Less common in C#)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚  Uses inheritance: Adapter EXTENDS Adaptee                                  â”‚
â”‚  ä½¿ç”¨ç»§æ‰¿: é€‚é…å™¨ç»§æ‰¿è¢«é€‚é…ç±»                                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  // Note: C# doesn't support multiple inheritance                  â”‚    â”‚
â”‚  â”‚  // This pattern is more common in C++ or Python                   â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  public class SFExpressAdapter : SFExpressClient, ICarrierAdapter  â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      // Inherits SF client methods directly                        â”‚    â”‚
â”‚  â”‚      // Problem: Tightly coupled to SF implementation              â”‚    â”‚
â”‚  â”‚  }                                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  âŒ Drawbacks:                                                               â”‚
â”‚  â€¢ Tight coupling to adaptee implementation                                 â”‚
â”‚  â€¢ Can't adapt multiple adaptees                                            â”‚
â”‚  â€¢ Violates composition over inheritance                                    â”‚
â”‚  â€¢ Hard to test in isolation                                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸšš Logistics Application

### Complete Adapter Implementation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CARRIER ADAPTER IMPLEMENTATION FLOW                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  STEP 1: Define Target Interface (å®šä¹‰ç›®æ ‡æ¥å£)                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  public interface ICarrierAdapter                                  â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      // Identity                                                   â”‚    â”‚
â”‚  â”‚      string CarrierCode { get; }           // "SF", "JD", "ZTO"   â”‚    â”‚
â”‚  â”‚      string CarrierName { get; }           // "é¡ºä¸°é€Ÿè¿"           â”‚    â”‚
â”‚  â”‚      bool IsAvailable { get; }             // Health status        â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚      // Core Operations (ç»Ÿä¸€æ¥å£)                                  â”‚    â”‚
â”‚  â”‚      Task<CarrierQuote> GetRateAsync(RateRequest request);        â”‚    â”‚
â”‚  â”‚      Task<BookingResult> BookShipmentAsync(BookingRequest request);â”‚    â”‚
â”‚  â”‚      Task<CancellationResult> CancelShipmentAsync(string trackingNo);â”‚    â”‚
â”‚  â”‚      Task<TrackingInfo> GetTrackingStatusAsync(string trackingNo); â”‚    â”‚
â”‚  â”‚      Task<Label> GenerateLabelAsync(LabelRequest request);        â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚      // Health                                                     â”‚    â”‚
â”‚  â”‚      Task<HealthStatus> CheckHealthAsync();                       â”‚    â”‚
â”‚  â”‚  }                                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  STEP 2: Implement SF Express Adapter (å®ç°é¡ºä¸°é€‚é…å™¨)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     REQUEST TRANSLATION                            â”‚    â”‚
â”‚  â”‚                     è¯·æ±‚è½¬æ¢                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  OUR BookingRequest:                    SF SFOrderRequest:                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ShipmentId: Guid     â”‚               â”‚ partnerID: string    â”‚           â”‚
â”‚  â”‚ CarrierCode: "SF"    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ requestID: string    â”‚           â”‚
â”‚  â”‚ Sender: ContactInfo  â”‚   Adapter     â”‚ cargoDetails: {...}  â”‚           â”‚
â”‚  â”‚   .FullName          â”‚   Translates  â”‚ deliverInfo: {...}   â”‚           â”‚
â”‚  â”‚   .Phone             â”‚               â”‚ serviceList: [...]   â”‚           â”‚
â”‚  â”‚   .Province          â”‚               â”‚                      â”‚           â”‚
â”‚  â”‚   .City              â”‚               â”‚ // SF-specific auth: â”‚           â”‚
â”‚  â”‚   .District          â”‚               â”‚ timestamp: long      â”‚           â”‚
â”‚  â”‚   .Address           â”‚               â”‚ msgDigest: string    â”‚           â”‚
â”‚  â”‚ Recipient: ...       â”‚               â”‚ (HMAC-MD5 signature) â”‚           â”‚
â”‚  â”‚ Packages: [...]      â”‚               â”‚                      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     RESPONSE TRANSLATION                           â”‚    â”‚
â”‚  â”‚                     å“åº”è½¬æ¢                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  SF SFOrderResponse:                    OUR BookingResult:                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ success: boolean     â”‚               â”‚ Success: bool        â”‚           â”‚
â”‚  â”‚ errorCode: string    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ TrackingNumber       â”‚           â”‚
â”‚  â”‚ errorMsg: string     â”‚   Adapter     â”‚ WaybillNumber        â”‚           â”‚
â”‚  â”‚ msgData: {           â”‚   Translates  â”‚ CarrierCode: "SF"    â”‚           â”‚
â”‚  â”‚   waybillNoInfoList: â”‚   Back        â”‚ BookingReference     â”‚           â”‚
â”‚  â”‚   [{                 â”‚               â”‚ EstimatedPickup      â”‚           â”‚
â”‚  â”‚     waybillNo: "SF..." â”‚             â”‚ LabelUrl             â”‚           â”‚
â”‚  â”‚   }]                 â”‚               â”‚ ErrorMessage         â”‚           â”‚
â”‚  â”‚ }                    â”‚               â”‚                      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                              â”‚
â”‚  STEP 3: Implement JD Adapter (Different Auth!) (å®ç°äº¬ä¸œé€‚é…å™¨)             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  public class JDLogisticsAdapter : ICarrierAdapter                 â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      private readonly IJDApiClient _jdClient;                     â”‚    â”‚
â”‚  â”‚      private readonly IJDTokenManager _tokenManager;  // OAuth!   â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚      public async Task<BookingResult> BookShipmentAsync(           â”‚    â”‚
â”‚  â”‚          BookingRequest request)                                   â”‚    â”‚
â”‚  â”‚      {                                                             â”‚    â”‚
â”‚  â”‚          // JD uses OAuth 2.0 (different from SF!)                 â”‚    â”‚
â”‚  â”‚          var token = await _tokenManager.GetValidTokenAsync();     â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚          // JD request format is COMPLETELY different              â”‚    â”‚
â”‚  â”‚          var jdRequest = new JDOrderSubmitRequest {                â”‚    â”‚
â”‚  â”‚              customerCode = _config.CustomerCode,                  â”‚    â”‚
â”‚  â”‚              orderInfo = new JDOrderInfo {                        â”‚    â”‚
â”‚  â”‚                  orderId = request.ShipmentId.ToString(),         â”‚    â”‚
â”‚  â”‚                  orderType = 1, // JD uses integers for types     â”‚    â”‚
â”‚  â”‚                  senderInfo = MapSender(request.Sender),          â”‚    â”‚
â”‚  â”‚                  receiverInfo = MapRecipient(request.Recipient),  â”‚    â”‚
â”‚  â”‚              },                                                    â”‚    â”‚
â”‚  â”‚              packageInfo = request.Packages                        â”‚    â”‚
â”‚  â”‚                  .Select(MapToJDPackage)                          â”‚    â”‚
â”‚  â”‚                  .ToList()                                        â”‚    â”‚
â”‚  â”‚          };                                                        â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚          var jdResponse = await _jdClient.SubmitOrderAsync(       â”‚    â”‚
â”‚  â”‚              jdRequest, token);                                   â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚          return MapFromJDResponse(jdResponse);                    â”‚    â”‚
â”‚  â”‚      }                                                             â”‚    â”‚
â”‚  â”‚  }                                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  KEY INSIGHT: Client (CarrierService) uses SAME interface for both!        â”‚
â”‚  å…³é”®æ´å¯Ÿ: å®¢æˆ·ç«¯å¯¹ä¸¤ä¸ªæ‰¿è¿å•†ä½¿ç”¨ç›¸åŒçš„æ¥å£!                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Status Code Normalization (Essential Adapter Responsibility)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATUS CODE NORMALIZATION                                 â”‚
â”‚                    çŠ¶æ€ç æ ‡å‡†åŒ–                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  PROBLEM: Every carrier uses different status codes!                        â”‚
â”‚  é—®é¢˜: æ¯å®¶æ‰¿è¿å•†ä½¿ç”¨ä¸åŒçš„çŠ¶æ€ç !                                             â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  SF Status    â”‚  JD Status     â”‚  ZTO Status  â”‚  Our Unified      â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  10           â”‚  "CREATED"     â”‚  0           â”‚  CREATED          â”‚    â”‚
â”‚  â”‚  20           â”‚  "COLLECTED"   â”‚  1           â”‚  PICKED_UP        â”‚    â”‚
â”‚  â”‚  30           â”‚  "TRANSPORTING"â”‚  2           â”‚  IN_TRANSIT       â”‚    â”‚
â”‚  â”‚  40           â”‚  "DELIVERING"  â”‚  3           â”‚  OUT_FOR_DELIVERY â”‚    â”‚
â”‚  â”‚  50           â”‚  "SIGNED"      â”‚  4           â”‚  DELIVERED        â”‚    â”‚
â”‚  â”‚  80           â”‚  "EXCEPTION"   â”‚  8           â”‚  EXCEPTION        â”‚    â”‚
â”‚  â”‚  90           â”‚  "CANCELLED"   â”‚  9           â”‚  CANCELLED        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  ADAPTER RESPONSIBILITY: Map carrier status â†’ Our status                    â”‚
â”‚  é€‚é…å™¨èŒè´£: å°†æ‰¿è¿å•†çŠ¶æ€æ˜ å°„åˆ°æˆ‘ä»¬çš„çŠ¶æ€                                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  // In SFExpressAdapter                                            â”‚    â”‚
â”‚  â”‚  private ShipmentStatus MapSFStatus(int sfStatus) => sfStatus switch â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      10 => ShipmentStatus.Created,                                â”‚    â”‚
â”‚  â”‚      20 => ShipmentStatus.PickedUp,                               â”‚    â”‚
â”‚  â”‚      30 => ShipmentStatus.InTransit,                              â”‚    â”‚
â”‚  â”‚      40 => ShipmentStatus.OutForDelivery,                         â”‚    â”‚
â”‚  â”‚      50 => ShipmentStatus.Delivered,                              â”‚    â”‚
â”‚  â”‚      80 => ShipmentStatus.Exception,                              â”‚    â”‚
â”‚  â”‚      90 => ShipmentStatus.Cancelled,                              â”‚    â”‚
â”‚  â”‚      _ => ShipmentStatus.Unknown                                  â”‚    â”‚
â”‚  â”‚  };                                                                â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  // In JDLogisticsAdapter (different mapping!)                    â”‚    â”‚
â”‚  â”‚  private ShipmentStatus MapJDStatus(string jdStatus) => jdStatus switch â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      "CREATED" => ShipmentStatus.Created,                         â”‚    â”‚
â”‚  â”‚      "COLLECTED" => ShipmentStatus.PickedUp,                      â”‚    â”‚
â”‚  â”‚      "TRANSPORTING" => ShipmentStatus.InTransit,                  â”‚    â”‚
â”‚  â”‚      // ... etc                                                   â”‚    â”‚
â”‚  â”‚  };                                                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  BENEFIT: Downstream services work with ONE status enum!                    â”‚
â”‚  å¥½å¤„: ä¸‹æ¸¸æœåŠ¡åªéœ€å¤„ç†ä¸€ç§çŠ¶æ€æšä¸¾!                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš–ï¸ Adapter vs Facade vs Proxy

### Pattern Comparison Decision Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHEN TO USE WHICH PATTERN?                                â”‚
â”‚                    ä½•æ—¶ä½¿ç”¨å“ªç§æ¨¡å¼?                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  QUESTION: What problem are you solving?                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚                          â”‚                          â”‚            â”‚
â”‚         â–¼                          â–¼                          â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ External system â”‚       â”‚ Complex internalâ”‚       â”‚ Need to add     â”‚  â”‚
â”‚  â”‚ has DIFFERENT   â”‚       â”‚ subsystem needs â”‚       â”‚ BEHAVIOR to     â”‚  â”‚
â”‚  â”‚ interface       â”‚       â”‚ SIMPLIFICATION  â”‚       â”‚ existing object â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                         â”‚                         â”‚            â”‚
â”‚           â–¼                         â–¼                         â–¼            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚   ADAPTER   â”‚          â”‚   FACADE    â”‚          â”‚    PROXY    â”‚      â”‚
â”‚    â”‚   é€‚é…å™¨    â”‚          â”‚    å¤–è§‚     â”‚          â”‚    ä»£ç†     â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Detailed Comparison

| Aspect | Adapter | Facade | Proxy |
|--------|---------|--------|-------|
| **Intent** | Convert interface A â†’ B | Simplify complex subsystem | Control access to object |
| **Direction** | External â†’ Internal | Internal â†’ Simplified | Same interface, added behavior |
| **Interface Change** | YES (different interface) | YES (simpler interface) | NO (same interface) |
| **Typical Use** | 3rd party API integration | Multiple services coordination | Caching, logging, auth |

### Logistics Examples

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PATTERN EXAMPLES IN LOGISTICS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ADAPTER EXAMPLE: SF Express API Integration                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  CarrierService â”‚â”€â”€â”€â”€â”€â–¶â”‚ ICarrierAdapter â”‚â—€â”€â”€â”€â”€â”€â”‚SFExpressAdapter â”‚     â”‚
â”‚  â”‚  (Our Code)     â”‚      â”‚ (Our Interface) â”‚      â”‚ (Translates)    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚              â”‚
â”‚                                                              â–¼              â”‚
â”‚                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                                    â”‚ SF Express API  â”‚     â”‚
â”‚                                                    â”‚ (Different!)    â”‚     â”‚
â”‚                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                                              â”‚
â”‚  FACADE EXAMPLE: Shipping Process Orchestration                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  OrderService   â”‚â”€â”€â”€â”€â”€â–¶â”‚         ShippingFacade                  â”‚      â”‚
â”‚  â”‚  (Client)       â”‚      â”‚                                         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  ProcessShipmentAsync(order)            â”‚      â”‚
â”‚                           â”‚  {                                      â”‚      â”‚
â”‚                           â”‚    1. routeService.Calculate()          â”‚      â”‚
â”‚                           â”‚    2. carrierService.GetRates()         â”‚      â”‚
â”‚                           â”‚    3. selectionService.SelectBest()     â”‚      â”‚
â”‚                           â”‚    4. carrierService.Book()             â”‚      â”‚
â”‚                           â”‚    5. labelService.Generate()           â”‚      â”‚
â”‚                           â”‚    6. notificationService.Notify()      â”‚      â”‚
â”‚                           â”‚  }                                      â”‚      â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                                              â”‚
â”‚  PROXY EXAMPLE: Cached Rate Queries                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  CarrierService â”‚â”€â”€â”€â”€â”€â–¶â”‚ ICarrierAdapter â”‚â—€â”€â”€â”€â”€â”€â”‚CachingProxy     â”‚     â”‚
â”‚  â”‚  (Client)       â”‚      â”‚ (Same Interface)â”‚      â”‚                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ Checks cache    â”‚     â”‚
â”‚                                                    â”‚ before calling: â”‚     â”‚
â”‚                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚              â”‚
â”‚                                                              â–¼              â”‚
â”‚                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                                    â”‚SFExpressAdapter â”‚     â”‚
â”‚                                                    â”‚(Real Adapter)   â”‚     â”‚
â”‚                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš–ï¸ SOLID Principles Alignment

### How Adapter Pattern Supports SOLID

| Principle | Without Adapter | With Adapter |
|-----------|----------------|--------------|
| **S** - Single Responsibility | CarrierService handles ALL carrier logic | Each adapter handles ONE carrier |
| **O** - Open/Closed | Add carrier = modify CarrierService | Add carrier = new adapter class |
| **L** - Liskov Substitution | N/A | All adapters interchangeable via interface |
| **I** - Interface Segregation | One giant class | Clean ICarrierAdapter contract |
| **D** - Dependency Inversion | Depends on concrete carrier APIs | Depends on ICarrierAdapter interface |

### Open/Closed Principle Deep Dive

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ADDING A NEW CARRIER: BEST EXPRESS (ç™¾ä¸–å¿«é€’)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  WITHOUT ADAPTER PATTERN:                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚  Files to MODIFY:                                                            â”‚
â”‚  âœ— CarrierService.cs        â†’ Add another else-if (800+ line file)         â”‚
â”‚  âœ— CarrierServiceTests.cs   â†’ Update all tests                             â”‚
â”‚  âœ— Mapping classes          â†’ Add Best mappings everywhere                 â”‚
â”‚                                                                              â”‚
â”‚  Risk: HIGH (modifying 800-line file, may break other carriers)            â”‚
â”‚  é£é™©: é«˜ï¼ˆä¿®æ”¹800è¡Œçš„æ–‡ä»¶ï¼Œå¯èƒ½ç ´åå…¶ä»–æ‰¿è¿å•†ï¼‰                                â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                                              â”‚
â”‚  WITH ADAPTER PATTERN:                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚  Files to CREATE (new):                                                      â”‚
â”‚  âœ“ BestExpressAdapter.cs            â†’ New adapter                          â”‚
â”‚  âœ“ BestExpressAdapterTests.cs       â†’ Isolated tests                       â”‚
â”‚  âœ“ BestExpressModels.cs             â†’ Best-specific DTOs                   â”‚
â”‚                                                                              â”‚
â”‚  Files to MODIFY:                                                            â”‚
â”‚  â—‹ DependencyInjection.cs â†’ One line: services.AddTransient<...>()         â”‚
â”‚                                                                              â”‚
â”‚  Files UNTOUCHED:                                                            â”‚
â”‚  âœ“ CarrierService.cs                                                        â”‚
â”‚  âœ“ SFExpressAdapter.cs                                                      â”‚
â”‚  âœ“ JDLogisticsAdapter.cs                                                    â”‚
â”‚  âœ“ All existing tests                                                       â”‚
â”‚                                                                              â”‚
â”‚  Risk: ZERO (no existing code modified)                                     â”‚
â”‚  é£é™©: é›¶ï¼ˆä¸ä¿®æ”¹ä»»ä½•ç°æœ‰ä»£ç ï¼‰                                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  // DependencyInjection.cs - ONE line added                        â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  services.AddTransient<ICarrierAdapter, SFExpressAdapter>();      â”‚    â”‚
â”‚  â”‚  services.AddTransient<ICarrierAdapter, JDLogisticsAdapter>();    â”‚    â”‚
â”‚  â”‚  services.AddTransient<ICarrierAdapter, ZTOExpressAdapter>();     â”‚    â”‚
â”‚  â”‚  services.AddTransient<ICarrierAdapter, BestExpressAdapter>();  // NEW â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  // Factory automatically discovers the new adapter!              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ Implementation Variations

### Variation 1: Two-Way Adapter

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TWO-WAY ADAPTER (åŒå‘é€‚é…å™¨)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  USE CASE: Receive webhooks FROM carrier + Send requests TO carrier         â”‚
â”‚  åœºæ™¯: æ¥æ”¶æ‰¿è¿å•†çš„webhook + å‘é€è¯·æ±‚ç»™æ‰¿è¿å•†                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  public interface ICarrierAdapter                                   â”‚   â”‚
â”‚  â”‚  {                                                                  â”‚   â”‚
â”‚  â”‚      // Outbound (æˆ‘ä»¬â†’æ‰¿è¿å•†)                                       â”‚   â”‚
â”‚  â”‚      Task<BookingResult> BookShipmentAsync(BookingRequest request); â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚      // Inbound (æ‰¿è¿å•†â†’æˆ‘ä»¬)                                        â”‚   â”‚
â”‚  â”‚      TrackingUpdate ParseWebhookPayload(string payload);            â”‚   â”‚
â”‚  â”‚      bool ValidateWebhookSignature(string payload, string sig);     â”‚   â”‚
â”‚  â”‚  }                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  SF WEBHOOK PAYLOAD:              OUR UNIFIED FORMAT:                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ {                    â”‚         â”‚ TrackingUpdate {     â”‚                 â”‚
â”‚  â”‚   "waybillNo": "SF.."â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   TrackingNo: "SF.." â”‚                 â”‚
â”‚  â”‚   "routeInfo": {     â”‚ Adapter â”‚   Status: InTransit  â”‚                 â”‚
â”‚  â”‚     "opCode": "30",  â”‚ Parses  â”‚   Location: "åŒ—äº¬"    â”‚                 â”‚
â”‚  â”‚     "remark": "åˆ°è¾¾åŒ—äº¬"â”‚        â”‚   Description: ...   â”‚                 â”‚
â”‚  â”‚   }                  â”‚         â”‚   Timestamp: ...     â”‚                 â”‚
â”‚  â”‚ }                    â”‚         â”‚ }                    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Variation 2: Adapter with Decorator (Caching + Logging)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DECORATOR CHAIN ON ADAPTER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Request Flow:                                                               â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  LoggingDecorator   â”‚  â†’ Logs request/response                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚             â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  CachingDecorator   â”‚  â†’ Checks cache for rate queries                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚             â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚  â”‚CircuitBreakerDecoratorâ”‚ â†’ Prevents cascade failures                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚             â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  RetryDecorator     â”‚  â†’ Retries transient failures                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚             â–¼                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  SFExpressAdapter   â”‚  â†’ Actual SF API call                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚                                                                              â”‚
â”‚  IMPLEMENTATION:                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  // All decorators implement ICarrierAdapter                       â”‚    â”‚
â”‚  â”‚  // Each wraps another ICarrierAdapter                             â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  public class CachingDecorator : ICarrierAdapter                   â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      private readonly ICarrierAdapter _inner;                      â”‚    â”‚
â”‚  â”‚      private readonly IDistributedCache _cache;                    â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚      public async Task<CarrierQuote> GetRateAsync(RateRequest req) â”‚    â”‚
â”‚  â”‚      {                                                             â”‚    â”‚
â”‚  â”‚          var cacheKey = $"rate:{CarrierCode}:{req.GetHashCode()}"; â”‚    â”‚
â”‚  â”‚          var cached = await _cache.GetAsync<CarrierQuote>(cacheKey);â”‚    â”‚
â”‚  â”‚          if (cached != null) return cached;                        â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚          var result = await _inner.GetRateAsync(req);  // Delegate â”‚    â”‚
â”‚  â”‚          await _cache.SetAsync(cacheKey, result, TimeSpan...);     â”‚    â”‚
â”‚  â”‚          return result;                                            â”‚    â”‚
â”‚  â”‚      }                                                             â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚      // Booking doesn't cache - just delegates                     â”‚    â”‚
â”‚  â”‚      public Task<BookingResult> BookShipmentAsync(BookingRequest r)â”‚    â”‚
â”‚  â”‚          => _inner.BookShipmentAsync(r);                           â”‚    â”‚
â”‚  â”‚  }                                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Variation 3: Pluggable Adapter (Extension Interface)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PLUGGABLE ADAPTER WITH CAPABILITY INTERFACES              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  PROBLEM: Not all carriers support all features                             â”‚
â”‚  é—®é¢˜: ä¸æ˜¯æ‰€æœ‰æ‰¿è¿å•†éƒ½æ”¯æŒæ‰€æœ‰åŠŸèƒ½                                            â”‚
â”‚                                                                              â”‚
â”‚  SF Express:  Express âœ“  |  COD âœ“  |  Cold Chain âœ“  |  Insurance âœ“        â”‚
â”‚  ZTO Express: Express âœ“  |  COD âœ—  |  Cold Chain âœ—  |  Insurance âœ“        â”‚
â”‚  Yunda:       Express âœ“  |  COD âœ“  |  Cold Chain âœ—  |  Insurance âœ—        â”‚
â”‚                                                                              â”‚
â”‚  SOLUTION: Capability interfaces (optional implementation)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  // Base interface - all carriers implement                        â”‚    â”‚
â”‚  â”‚  public interface ICarrierAdapter                                  â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      Task<BookingResult> BookShipmentAsync(BookingRequest req);   â”‚    â”‚
â”‚  â”‚  }                                                                 â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  // Optional capability: Cash On Delivery                          â”‚    â”‚
â”‚  â”‚  public interface ICODCapable                                      â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      Task<decimal> GetCODFeeAsync(decimal amount);                â”‚    â”‚
â”‚  â”‚      decimal MaxCODAmount { get; }                                â”‚    â”‚
â”‚  â”‚  }                                                                 â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  // Optional capability: Cold Chain                                â”‚    â”‚
â”‚  â”‚  public interface IColdChainCapable                                â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      Task<TemperatureLog[]> GetTemperatureLogsAsync(string trackingNo); â”‚    â”‚
â”‚  â”‚      TemperatureRange SupportedRange { get; }                     â”‚    â”‚
â”‚  â”‚  }                                                                 â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  // SF implements all capabilities                                 â”‚    â”‚
â”‚  â”‚  public class SFExpressAdapter :                                  â”‚    â”‚
â”‚  â”‚      ICarrierAdapter, ICODCapable, IColdChainCapable              â”‚    â”‚
â”‚  â”‚  { ... }                                                          â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚  // ZTO only implements base                                       â”‚    â”‚
â”‚  â”‚  public class ZTOExpressAdapter : ICarrierAdapter                 â”‚    â”‚
â”‚  â”‚  { ... }                                                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  USAGE:                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  public async Task ProcessCODOrder(string carrierCode)             â”‚    â”‚
â”‚  â”‚  {                                                                 â”‚    â”‚
â”‚  â”‚      var adapter = _factory.GetAdapter(carrierCode);               â”‚    â”‚
â”‚  â”‚                                                                    â”‚    â”‚
â”‚  â”‚      // Check if carrier supports COD                              â”‚    â”‚
â”‚  â”‚      if (adapter is ICODCapable codAdapter)                       â”‚    â”‚
â”‚  â”‚      {                                                             â”‚    â”‚
â”‚  â”‚          var fee = await codAdapter.GetCODFeeAsync(1000);         â”‚    â”‚
â”‚  â”‚      }                                                             â”‚    â”‚
â”‚  â”‚      else                                                          â”‚    â”‚
â”‚  â”‚      {                                                             â”‚    â”‚
â”‚  â”‚          throw new CarrierNotSupportedFeatureException(            â”‚    â”‚
â”‚  â”‚              carrierCode, "COD");                                  â”‚    â”‚
â”‚  â”‚      }                                                             â”‚    â”‚
â”‚  â”‚  }                                                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ Anti-Patterns to Avoid

### Anti-Pattern 1: Leaky Adapter

```csharp
// âŒ BAD: Adapter exposes carrier-specific details
public class SFExpressAdapter : ICarrierAdapter
{
    // WRONG: Carrier-specific exception leaks out
    public async Task<BookingResult> BookShipmentAsync(BookingRequest request)
    {
        var response = await _sfClient.CreateOrderAsync(sfRequest);
        
        if (!response.Success)
        {
            // âŒ Exposing SF-specific error codes!
            throw new SFApiException(response.ErrorCode, response.ErrorMsg);
        }
    }
}

// âœ… GOOD: Wrap in domain exception
public async Task<BookingResult> BookShipmentAsync(BookingRequest request)
{
    try
    {
        var response = await _sfClient.CreateOrderAsync(sfRequest);
        if (!response.Success)
        {
            // âœ… Domain exception, no SF details exposed
            throw new CarrierBookingFailedException(
                CarrierCode,
                MapErrorToMessage(response.ErrorCode));
        }
    }
    catch (HttpRequestException ex)
    {
        throw new CarrierUnavailableException(CarrierCode, ex);
    }
}
```

### Anti-Pattern 2: God Adapter

```csharp
// âŒ BAD: Adapter does too much
public class SFExpressAdapter : ICarrierAdapter
{
    public async Task<BookingResult> BookShipmentAsync(BookingRequest request)
    {
        // âŒ Validation should be in domain layer
        if (request.Sender == null) throw new ArgumentException();
        
        // âŒ Business logic should be in service layer
        if (await _blacklistService.IsBlacklisted(request.Recipient.Phone))
            throw new BlacklistedException();
        
        // âŒ Notification should be handled by event
        await _emailService.SendConfirmationAsync(...);
        
        // Finally, the actual adaptation
        var sfRequest = MapToSFFormat(request);
        return await CallSFApi(sfRequest);
    }
}

// âœ… GOOD: Adapter ONLY adapts
public async Task<BookingResult> BookShipmentAsync(BookingRequest request)
{
    // Only: translate, call, translate back
    var sfRequest = MapToSFFormat(request);
    var sfResponse = await _sfClient.CreateOrderAsync(sfRequest);
    return MapFromSFResponse(sfResponse);
    // Validation, business rules, notifications handled elsewhere
}
```

### Anti-Pattern 3: Shared Adapter State

```csharp
// âŒ BAD: Adapter has mutable state
public class SFExpressAdapter : ICarrierAdapter
{
    private BookingRequest _lastRequest;  // âŒ State!
    private BookingResult _cachedResult;   // âŒ Should use decorator
    
    public async Task<BookingResult> BookShipmentAsync(BookingRequest request)
    {
        // âŒ Not thread-safe, causes race conditions
        if (_lastRequest == request) return _cachedResult;
        
        _lastRequest = request;
        _cachedResult = await DoBook(request);
        return _cachedResult;
    }
}

// âœ… GOOD: Adapters are stateless
public class SFExpressAdapter : ICarrierAdapter
{
    // No mutable fields
    private readonly ISFExpressApiClient _sfClient;  // Injected, immutable
    
    // For caching, use decorator pattern instead
}
```

---

## ğŸ‡¨ğŸ‡³ Chinese Tech References

### CSDN Articles to Study

| Search Keyword | Focus | æ¨èç­‰çº§ |
|---------------|-------|----------|
| `é€‚é…å™¨æ¨¡å¼ C# å®æˆ˜` | Basic implementation | â˜…â˜…â˜…â˜…â˜… |
| `ç‰©æµç³»ç»Ÿ APIé€‚é…å™¨` | Logistics application | â˜…â˜…â˜…â˜…â˜† |
| `é¡ºä¸°APIå¯¹æ¥ é€‚é…å™¨` | SF Express integration | â˜…â˜…â˜…â˜…â˜… |
| `å¤šæ‰¿è¿å•†é›†æˆ è®¾è®¡æ¨¡å¼` | Multi-carrier design | â˜…â˜…â˜…â˜…â˜† |
| `ç¬¬ä¸‰æ–¹APIé›†æˆ æœ€ä½³å®è·µ` | API integration patterns | â˜…â˜…â˜…â˜…â˜† |

### Carrier API Documentation (Official)

| Carrier | Portal | Key Docs | API Style |
|---------|--------|----------|-----------|
| SF Express | open.sf-express.com | å¼€å‘æŒ‡å—, APIæ–‡æ¡£ | REST + HMAC |
| JD Logistics | open.jdl.com | æ¥å…¥æ–‡æ¡£, SDK | REST + OAuth |
| ZTO Express | open.zto.com | å¯¹æ¥æŒ‡å— | REST + API Key |
| Cainiao | open.taobao.com/doc | ç‰©æµAPI | REST + OAuth |

### Gitee Repositories

| Repository | Content |
|------------|---------|
| `dotnet-campus/DesignPattern` | C# pattern examples |
| `ABP-CN/CarrierAdapter-Sample` | Carrier adapter examples |
| `gitee/logistics-integration` | Multi-carrier samples |

---

## ğŸ“ Self-Assessment

### Knowledge Check Questions

| # | Question | Expected Understanding |
|---|----------|----------------------|
| 1 | What's the difference between Object Adapter and Class Adapter? | Object uses composition (preferred), Class uses inheritance |
| 2 | Why is Adapter preferred over adding `if/else` branches? | Open/Closed principle - add new adapters without modifying existing code |
| 3 | What's the difference between Adapter and Proxy? | Adapter changes interface, Proxy adds behavior to same interface |
| 4 | Should authentication logic be in the adapter? | Yes, it's part of "translating" to the carrier's requirements |
| 5 | How do you handle carrier-specific features not all carriers support? | Optional capability interfaces (ICODCapable, IColdChainCapable) |

### Practical Exercises

1. **[ ] Implement SF Express Adapter**
   - Study SF API docs at open.sf-express.com
   - Implement HMAC-MD5 signature authentication
   - Map BookingRequest â†’ SFOrderRequest

2. **[ ] Compare JD vs SF Authentication**
   - SF: HMAC-MD5 signature in header
   - JD: OAuth 2.0 with token refresh
   - Document the differences in your adapter implementations

3. **[ ] Design Status Mapping**
   - Get status codes from SF, JD, ZTO documentation
   - Create unified ShipmentStatus enum
   - Implement mapping in each adapter

4. **[ ] Add Caching Decorator**
   - Create CachingAdapterDecorator implementing ICarrierAdapter
   - Cache only GetRateAsync (not BookShipmentAsync)
   - Use IDistributedCache for cross-server caching

---

## ğŸ”— Related Documents

- **Applied in**: [02-MULTI-CARRIER.md](../core-domains/02-MULTI-CARRIER.md)
- **Combined with**: [FACTORY-PATTERN.md](FACTORY-PATTERN.md) (adapter creation)
- **Can use with**: [STRATEGY-PATTERN.md](STRATEGY-PATTERN.md) (carrier selection)
- **Index**: [00-INDEX.md](../00-INDEX.md)

---